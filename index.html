<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Illuminated Pro Hub</title>
  <meta name="description" content="Central hub for Illuminated Thinking tools and resources." />
  <style>
    :root {
      --bg:#f9fafc; --ink:#111827; --muted:#6b7280; --border:#e5e7eb; --card:#fff;
      --brand:#3b82f6;
    }
    /* Light/Dark preference (optional) */
    @media (prefers-color-scheme: dark){
      :root { --bg:#0b0f14; --ink:#e5e7eb; --muted:#9aa4b2; --border:#263041; --card:#0f141b; --brand:#6ea8ff; }
      body { color-scheme: dark; }
    }

    /* Base */
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--ink); display:flex; min-height:100vh; flex-direction:column; }
    a { color:inherit; }

    /* Header */
    header { background:#fff; border-bottom:1px solid var(--border); }
    @media (prefers-color-scheme: dark){ header{ background:#0f141b; } }
    .nav { max-width:1100px; margin:0 auto; padding:12px 20px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brand { display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--ink); font-weight:700; }
    .brand img { width:28px; height:28px; display:block; }
    .brand span { font-size:1.05rem; letter-spacing:.2px; }

    .nav-right { display:flex; align-items:center; gap:10px; }
    .user { display:flex; align-items:center; gap:10px; }
    .avatar { width:32px; height:32px; border-radius:999px; background:#eef2ff; color:var(--brand); display:grid; place-items:center; font-weight:700; font-size:.9rem; border:1px solid #dbe2ff; }
    @media (prefers-color-scheme: dark){ .avatar{ background:#132033; border-color:#20314b; } }
    .user-name { font-size:.95rem; }
    .menu { position:relative; }
    .menu-btn { border:1px solid var(--border); background:#fff; border-radius:8px; padding:6px 10px; font-size:.85rem; cursor:pointer; }
    @media (prefers-color-scheme: dark){ .menu-btn{ background:#0f141b; } }
    .menu-pop { position:absolute; right:0; top:40px; background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:0 10px 30px rgba(12,22,44,.1); min-width:200px; padding:6px; display:none; }
    @media (prefers-color-scheme: dark){ .menu-pop{ background:#0f141b; } }
    .menu-pop a { display:block; padding:10px 12px; text-decoration:none; color:var(--ink); border-radius:8px; font-size:.9rem; }
    .menu-pop a:hover { background:#f3f4f6; }
    @media (prefers-color-scheme: dark){ .menu-pop a:hover{ background:#16202c; } }
    .sign-in { border:1px solid var(--border); background:#fff; border-radius:8px; padding:6px 10px; font-size:.85rem; text-decoration:none; }
    @media (max-width:520px){ .user-name { display:none; } }

    /* Main */
    main.wrap { flex:1; max-width:900px; margin:0 auto; padding:40px 20px; }
    h1 { font-size:2rem; margin:0 0 20px; text-align:center; }
    .grid { display:grid; gap:20px; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); }
    .card { background:var(--card); padding:24px; border-radius:12px; border:1px solid var(--border); text-align:center; text-decoration:none; color:var(--ink); transition:0.2s; }
    .card:hover { border-color:#c9cbe3; box-shadow:0 6px 20px rgba(12,22,44,.08); }
    .card h3 { margin:0 0 10px; font-size:1.2rem; }
    .card p { margin:0; font-size:0.9rem; color:var(--muted); }

    /* Footer */
    footer { background:#fff; border-top:1px solid var(--border); padding:16px; font-size:0.85rem; text-align:center; color:var(--muted); }
    @media (prefers-color-scheme: dark){ footer{ background:#0f141b; } }
    footer a { color:inherit; text-decoration:none; margin:0 8px; }
    footer a:hover { text-decoration:underline; }
  </style>
</head>
<body>

<header>
  <div class="nav" role="navigation" aria-label="Primary">
    <!-- Logo: replace src with your file path -->
    <a class="brand" href="/" aria-label="Illuminated Pro Hub Home">
      <img src="/assets/logo.svg" alt="Illuminated Thinking logo" />
      <span>illuminated.pro ‚Äî Hub</span>
    </a>

    <div class="nav-right">
      <div class="user" aria-live="polite">
        <div id="avatar" class="avatar" aria-hidden="true">IT</div>
        <div id="userName" class="user-name">Guest</div>
      </div>

      <!-- Shown when NOT signed in -->
      <a id="signInLink" class="sign-in" href="/auth/login">Sign in</a>

      <!-- Shown when signed in -->
      <div id="accountMenu" class="menu" style="display:none;">
        <button id="menuBtn" class="menu-btn" aria-haspopup="true" aria-expanded="false">Account ‚ñæ</button>
        <div id="menuPop" class="menu-pop" role="menu" aria-label="User menu">
          <a href="/profile" role="menuitem">Profile</a>
          <a href="/billing" role="menuitem">Billing</a>
          <a href="/settings" role="menuitem">Settings</a>
          <hr style="border:none;border-top:1px solid var(--border); margin:6px 0;">
          <a href="/auth/logout" role="menuitem">Sign out</a>
        </div>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <h1>Welcome to the Hub</h1>
  <div class="grid">
    <a class="card" href="https://notes.illuminatednotes.net">
      <h3>üéôÔ∏è AI Transcribe Assistant</h3>
      <p>Accurate transcripts &amp; note drafting</p>
    </a>
    <a class="card" href="https://emdr.illuminated.pro">
      <h3>üîÅ Online BLS (EMDR)</h3>
      <p>Deliver remote bilateral stimulation</p>
    </a>
    <a class="card" href="https://formulation.illuminated.pro">
      <h3>üß© Formulation Builder</h3>
      <p>Create visual case formulations</p>
    </a>
    <a class="card" href="https://meet.illuminated.pro">
      <h3>üìπ Video Call</h3>
      <p>Coming Soon...</p>
    </a>
  </div>
</main>

<footer>
  <a href="/privacy">Privacy Policy</a> |
  <a href="/terms">Terms of Use</a> |
  <a href="/copyright">¬© Illuminated Thinking</a> |
  <a href="/support">Support</a> |
  <a href="/contact">Contact</a>
</footer>

<!-- Identity + menu script (requires Cloudflare Access middleware and /api/me) -->
<script>
(function () {
  const nameEl = document.getElementById('userName');
  const avatarEl = document.getElementById('avatar');
  const signInLink = document.getElementById('signInLink');
  const accountMenu = document.getElementById('accountMenu');
  const btn = document.getElementById('menuBtn');
  const pop = document.getElementById('menuPop');

  function initials(text){
    return (text || '')
      .split(/\s+/).filter(Boolean).slice(0,2)
      .map(s => s[0].toUpperCase()).join('') || 'IT';
  }

  // Fetch identity from Pages Function (validated by Cloudflare Access)
  fetch('/api/me', { credentials: 'include' })
    .then(r => { if (!r.ok) throw new Error('not authed'); return r.json(); })
    .then(data => {
      nameEl.textContent = data.name || data.email;
      if (data.picture) {
        avatarEl.style.background = 'transparent';
        avatarEl.style.border = 'none';
        avatarEl.innerHTML = '<img src="'+data.picture+'" alt="" style="width:100%;height:100%;border-radius:999px;display:block;object-fit:cover;">';
      } else {
        avatarEl.textContent = initials(data.name || data.email);
      }
      signInLink.style.display = 'none';
      accountMenu.style.display = 'block';
    })
    .catch(() => {
      // Not signed in
      nameEl.textContent = 'Guest';
      avatarEl.textContent = 'IT';
      signInLink.style.display = 'inline-block';
      accountMenu.style.display = 'none';
    });

  // Simple account menu toggle + close handlers
  btn && btn.addEventListener('click', () => {
    const open = pop.style.display === 'block';
    pop.style.display = open ? 'none' : 'block';
    btn.setAttribute('aria-expanded', String(!open));
  });
  document.addEventListener('click', (e) => {
    if (pop && btn && !pop.contains(e.target) && !btn.contains(e.target)) {
      pop.style.display = 'none';
      btn.setAttribute('aria-expanded', 'false');
    }
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && pop) {
      pop.style.display = 'none';
      btn.setAttribute('aria-expanded', 'false');
    }
  });
})();
</script>

</body>
</html>
